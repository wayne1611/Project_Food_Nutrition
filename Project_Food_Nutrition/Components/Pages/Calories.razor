@page "/Calories"
@rendermode InteractiveServer

<PageTitle>Calories Tracker</PageTitle>

<h1>Calories Tracker Intake</h1>

<p role="status">Total calories: @totalCalories</p>

<button class="btn btn-primary" @onclick="ShowInputField">Add Calories</button>

@if (showInput)
{
    <div>
        <label for="mealSelection">Select a meal:</label>
        <select id="mealSelection" class="form-control" @bind="selectedMealId">
            <option value="">-- Choose a Meal --</option>
            @foreach (var meal in meals)
            {
                <option value="@meal.Id">@meal.Name (@meal.CaloriesCount calories)</option>
            }
        </select>
        <button class="btn btn-success" @onclick="AddCalories">Add</button>
        <button class="btn btn-secondary" @onclick="CancelInput">Cancel</button>
    </div>
}

@code {
    private int totalCalories = 0;
    private bool showInput = false;
    private int? selectedMealId;
    private List<Meal> meals = new();

    protected override async Task OnInitializedAsync()
    {
        // Simulating fetching meals from the database or service.
        meals = new List<Meal>
        {
            new Meal { Id = 1, Name = "Chicken Salad", CaloriesCount = 750 },
            new Meal { Id = 2, Name = "Blue", CaloriesCount = 0 } // Replace 0 with actual calories if needed
        };
    }

    private void ShowInputField()
    {
        showInput = true;
    }

    private void AddCalories()
    {
        var selectedMeal = meals.FirstOrDefault(m => m.Id == selectedMealId);
        if (selectedMeal != null)
        {
            totalCalories += selectedMeal.CaloriesCount;
        }

        // Reset and hide the input field
        selectedMealId = null;
        showInput = false;
    }

    private void CancelInput()
    {
        selectedMealId = null; // Reset selection
        showInput = false; // Hide the input field
    }

    // Data model for meals
    private class Meal
    {
        public int Id { get; set; }
        public string Name { get; set; }
        public int CaloriesCount { get; set; }
    }
}
